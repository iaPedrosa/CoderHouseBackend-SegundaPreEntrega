<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@5/dark.css" />
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>



{{>header}}
<h1 class="text-center text-primary">LISTA DE PRODUCTOS</h1>
<h4 class="text-center text-secondary">Se pueden utilizar filtros</h1>



    <section class="mx-5">
        <div class="container">
            <div class="justify-content-center">
                <div class="text-center mb-4">
                    <a href="realtimeproducts" class="btn btn-info" role="button">Ir a RealTimeProducts</a>
                    <a href="cart/{{cartID}}" class="btn btn-success" role="button">Ir al Carrito</a>
                </div>
                {{#if error}}
                <h2 class="text-center text-danger m-5">{{error}}</h2>
                {{else}}

                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-sm table-dark border-secondary">
                        <thead>
                            <tr>
                                <th scope="col">Título</th>
                                <th scope="col">Descripción</th>
                                <th scope="col">Codigo</th>
                                <th scope="col">Precio</th>
                                <th scope="col">Stock</th>
                                <th scope="col">Categoría</th>
                                <th scope="col">Estado</th>
                                <th scope="col">ID</th>
                                <th scope="col">Cart</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each products}}
                            <tr>
                                <td>{{this.title}}</td>
                                <td>{{this.description}}</td>
                                <td>{{this.code}}</td>
                                <td>${{this.price}}</td>
                                <td>{{this.stock}}</td>
                                <td>{{this.category}}</td>
                                <td>{{this.status}}</td>
                                <td>{{this.id}}</td>
                                <td>
                                    <form action="api/carts/{{../cartID}}/products/{{this.id}}" method="post"
                                        class="post-form">
                                        <button type="submit" class="btn btn-info">Agregar</button>
                                    </form>
                                </td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
    </section>
    </div>
    <div class="d-flex justify-content-center mt-3">
        {{#if prevPage}}
        <a class="btn btn-info mr-5" href={{prevPage}}>Anterior página</a>
        {{/if}}

        {{#if nextPage}}
        <a class="btn btn-info" href={{nextPage}}>Siguiente página</a>
        {{/if}}


    </div>

    </div>


    </div>

    {{/if}}

    <script>

        function manejarEnvioFormulario(evento) {
            evento.preventDefault(); 

            const formulario = evento.target;
            const url = formulario.action;

            fetch(url, {
                method: 'POST',
            })
                .then(respuesta => respuesta.json())
                .then(datos => {
           
                    if (datos.error) {

                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: datos.error,

                        })
                    } else {
                        Swal.fire('Producto agregado al carrito')
                    }


                })
                .catch(error => {

                    
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'Ocurrió un error durante la solicitud POST.',

                    })
                    console.error('Error:', error);
                });
        }

        document.addEventListener('DOMContentLoaded', () => {
       
            const formularios = document.querySelectorAll('form.post-form');
            formularios.forEach(formulario => {
                formulario.addEventListener('submit', manejarEnvioFormulario);
            });
        });



    </script>

